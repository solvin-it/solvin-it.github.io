---
import MainLayout from '../layouts/MainLayout.astro';
import { siteConfig } from '../content/site.ts';

const title = `Contact | ${siteConfig.name}`;
const description = 'Get in touch to discuss AI/ML engineering opportunities, collaborations, or just to connect about technology and innovation.';
---

<MainLayout title={title} description={description}>
  <section class="section">
    <div class="container max-w-4xl">
      <!-- Page Header -->
      <div class="text-center mb-16 animate-in">
        <h1 class="heading-1 text-gray-900 dark:text-white mb-6">
          Let's Connect
        </h1>
        <p class="body-large max-w-2xl mx-auto">
          I'm actively seeking AI/ML engineering opportunities and always excited to discuss technology, share insights, or explore potential collaborations.
        </p>
      </div>

      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Contact Information -->
        <div class="space-y-8 animate-in" style="animation-delay: 0.1s">
          <div>
            <h2 class="heading-3 text-gray-900 dark:text-white mb-6">
              Get in Touch
            </h2>
            <p class="text-gray-600 dark:text-gray-300 mb-8">
              Whether you're looking for a Generative AI Engineer who brings unique business understanding to AI development, want to discuss an AI project, or just connect about building practical AI solutions, I'd love to hear from you. I'm based in Makati City, Philippines.
            </p>
          </div>

          <!-- Contact Methods -->
          <div class="space-y-6">
            <a 
              href={`mailto:${siteConfig.author.email}`}
              class="flex items-center space-x-4 p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group"
            >
              <div class="flex-shrink-0 w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center group-hover:bg-primary-200 dark:group-hover:bg-primary-800/30 transition-colors">
                <svg class="w-6 h-6 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                  Email
                </h3>
                <p class="text-gray-600 dark:text-gray-300">
                  {siteConfig.author.email}
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  Best for detailed discussions and opportunities
                </p>
              </div>
            </a>

            <a 
              href={siteConfig.author.linkedin}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center space-x-4 p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group"
            >
              <div class="flex-shrink-0 w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center group-hover:bg-blue-200 dark:group-hover:bg-blue-800/30 transition-colors">
                <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                  LinkedIn
                </h3>
                <p class="text-gray-600 dark:text-gray-300">
                  Professional networking
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  Great for quick connections and updates
                </p>
              </div>
            </a>

            <a 
              href={siteConfig.author.github}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center space-x-4 p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group"
            >
              <div class="flex-shrink-0 w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition-colors">
                <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                  GitHub
                </h3>
                <p class="text-gray-600 dark:text-gray-300">
                  Code repositories and projects
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  See my work and technical contributions
                </p>
              </div>
            </a>
          </div>

          <!-- Availability Status -->
          <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6">
            <div class="flex items-start space-x-3">
              <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-medium text-green-800 dark:text-green-300 mb-1">
                  Open to Opportunities
                </h3>
                <p class="text-green-700 dark:text-green-300 text-sm">
                  I'm actively seeking Generative AI Engineer roles and AI application development projects. I bring unique business context to AI solutions. Currently based in Makati City, Philippines. I typically respond within 24 hours.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Form -->
        <div class="animate-in" style="animation-delay: 0.2s">
          <div class="card p-8">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">
              Send a Message
            </h2>
            
            <form class="space-y-6" id="contact-form">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Name
                  </label>
                  <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
                    placeholder="Your name"
                  />
                </div>
                
                <div>
                  <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Email
                  </label>
                  <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"
                    placeholder="your.email@example.com"
                  />
                </div>
              </div>
              
              <div>
                <label for="subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Subject
                </label>
                <select 
                  id="subject" 
                  name="subject" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"
                >
                  <option value="">Select a subject...</option>
                  <option value="job-opportunity">Job Opportunity</option>
                  <option value="project-collaboration">Project Collaboration</option>
                  <option value="consulting">Consulting Inquiry</option>
                  <option value="speaking">Speaking Opportunity</option>
                  <option value="general">General Inquiry</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <div>
                <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Message
                </label>
                <textarea 
                  id="message" 
                  name="message" 
                  rows="6" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 resize-none"
                  placeholder="Tell me about your project, role, or what you'd like to discuss..."
                ></textarea>
              </div>
              
              <button 
                type="submit" 
                class="w-full btn btn-primary relative"
                id="submit-btn"
              >
                <span id="submit-text">Send Message</span>
                <div id="submit-spinner" class="hidden absolute inset-0 flex items-center justify-center">
                  <svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </div>
              </button>
              
              <!-- Form Status Messages -->
              <div id="form-success" class="hidden bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-green-800 dark:text-green-300">
                      Message sent successfully! I'll get back to you within 24 hours.
                    </p>
                  </div>
                </div>
              </div>
              
              <div id="form-error" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-red-800 dark:text-red-300">
                      There was an error sending your message. Please try again or contact me directly via email.
                    </p>
                  </div>
                </div>
              </div>
            </form>
            
            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 text-center">
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Prefer email? Reach me directly at 
                <a href={`mailto:${siteConfig.author.email}`} class="text-primary-600 dark:text-primary-400 hover:underline">
                  {siteConfig.author.email}
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- FAQ Section -->
      <div class="mt-20 animate-in" style="animation-delay: 0.4s">
        <h2 class="heading-3 text-gray-900 dark:text-white text-center mb-12">
          Frequently Asked Questions
        </h2>
        
        <div class="grid md:grid-cols-2 gap-8">
          <div class="space-y-6">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                What type of roles are you seeking?
              </h3>
              <p class="text-gray-600 dark:text-gray-300 text-sm">
                I'm primarily interested in Generative AI Engineer positions where I can apply my unique combination of business understanding and AI development skills. Also open to AI application development projects and consulting in business-focused AI solutions.
              </p>
            </div>
            
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                Are you available for freelance work?
              </h3>
              <p class="text-gray-600 dark:text-gray-300 text-sm">
                Yes! I'm available for business analysis, technical solutions consulting, and AI/ML exploration projects. I particularly enjoy helping companies bridge business requirements with technical implementations, especially in FinTech.
              </p>
            </div>
          </div>
          
          <div class="space-y-6">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                What's your preferred work setup?
              </h3>
              <p class="text-gray-600 dark:text-gray-300 text-sm">
                I'm open to remote, hybrid, or on-site arrangements. I have experience working effectively in all formats and believe the best setup depends on the team and project needs.
              </p>
            </div>
            
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                How quickly do you typically respond?
              </h3>
              <p class="text-gray-600 dark:text-gray-300 text-sm">
                I aim to respond to all inquiries within 24 hours, usually sooner. For urgent matters, LinkedIn messages or direct email tend to get the fastest response.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</MainLayout>

<style>
  .animate-in {
    animation: slideIn 0.6s ease-out forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .animate-in {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
</style>

<script>
  function initContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const submitText = document.getElementById('submit-text') as HTMLElement;
    const submitSpinner = document.getElementById('submit-spinner') as HTMLElement;
    const successMessage = document.getElementById('form-success') as HTMLElement;
    const errorMessage = document.getElementById('form-error') as HTMLElement;

    if (!form || !submitBtn) return;

    // reCAPTCHA v3 site key (public)
    const RECAPTCHA_SITE_KEY = '6LfGytYrAAAAANq24aKx_n9dmZBqDKQ8msEx_AOq';

    // Helper to load grecaptcha script and return grecaptcha object
    function loadRecaptcha(siteKey: string) {
      return new Promise((resolve, reject) => {
        if ((window as any).grecaptcha && (window as any).grecaptcha.execute) {
          return resolve((window as any).grecaptcha);
        }
        const s = document.createElement('script');
        s.src = `https://www.google.com/recaptcha/api.js?render=${siteKey}`;
        s.async = true;
        s.defer = true;
        s.onload = () => {
          if ((window as any).grecaptcha) resolve((window as any).grecaptcha);
          else reject(new Error('grecaptcha not available'));
        };
        s.onerror = () => reject(new Error('Failed to load grecaptcha'));
        document.head.appendChild(s);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Reset messages
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');

      // Show loading state
      submitBtn.disabled = true;
      submitText.classList.add('opacity-0');
      submitSpinner.classList.remove('hidden');

      try {
        // Send form data to Formspree
        const endpoint = 'https://formspree.io/f/xyznkjeg';
        const formData = new FormData(form);

        // Try to get reCAPTCHA token (v3) and append to formData
        try {
          const grecaptcha = await loadRecaptcha(RECAPTCHA_SITE_KEY);
          const token = await (grecaptcha as any).execute(RECAPTCHA_SITE_KEY, { action: 'contact' });
          if (token) formData.append('g-recaptcha-response', token);
        } catch (recapErr) {
          console.warn('reCAPTCHA token fetch failed, continuing without token', recapErr);
        }

        const res = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'Accept': 'application/json'
          },
          body: formData
        });

        if (res.ok) {
          // Success
          successMessage.classList.remove('hidden');
          form.reset();
        } else {
          // Try to show message from Formspree if present
          let errText = 'There was an error sending your message. Please try again or contact me directly via email.';
          try {
            const json = await res.json();
            if (json && json.error) errText = json.error;
          } catch (e) {
            // ignore
          }
          console.error('Formspree error', res.status, res.statusText);
          const p = errorMessage.querySelector('p');
          if (p) p.textContent = errText;
          errorMessage.classList.remove('hidden');
        }

      } catch (error) {
        console.error('Error sending message:', error);
        errorMessage.classList.remove('hidden');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitText.classList.remove('opacity-0');
        submitSpinner.classList.add('hidden');
      }
    });
  }

  // Initialize contact form
  document.addEventListener('DOMContentLoaded', initContactForm);
  document.addEventListener('astro:after-swap', initContactForm);
</script>