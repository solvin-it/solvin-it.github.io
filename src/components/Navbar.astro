---
import { siteConfig } from '../content/site.ts';
import ThemeToggle from './ThemeToggle.tsx';
---

<nav class="sticky top-0 z-50 bg-neutral-25/90 dark:bg-neutral-950/90 backdrop-blur-md border-b border-neutral-300 dark:border-neutral-700 shadow-sm">
  <div class="container">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a 
          href="/" 
          class="text-2xl font-serif font-medium text-neutral-900 dark:text-neutral-100 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300"
          aria-label="Home"
        >
          {siteConfig.name}
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="flex items-center space-x-10">
          {siteConfig.navigation.map((item) => (
            <a
              href={item.href}
              class="text-neutral-700 dark:text-neutral-300 hover:text-primary-700 dark:hover:text-primary-400 font-medium tracking-wide transition-all duration-300 relative group uppercase text-sm"
            >
              {item.label}
              <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-600 transition-all duration-300 group-hover:w-full"></span>
            </a>
          ))}
        </div>
      </div>

      <!-- Theme Toggle & Mobile Menu Button -->
      <div class="flex items-center space-x-4">
        <ThemeToggle client:load />
        
        <!-- Mobile menu button -->
        <button
          type="button"
          class="md:hidden p-3 text-neutral-500 dark:text-neutral-400 hover:text-primary-700 dark:hover:text-primary-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-none transition-all duration-300 border border-transparent hover:border-neutral-300 dark:hover:border-neutral-600"
          aria-label="Open navigation menu"
          aria-expanded="false"
          data-mobile-menu-button
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  <div 
    class="md:hidden fixed inset-0 top-20 bg-neutral-25 dark:bg-neutral-950 z-40 transform translate-x-full transition-transform duration-300 ease-in-out pointer-events-none border-l border-neutral-300 dark:border-neutral-700"
    data-mobile-menu
    style="touch-action: pan-y; left: 0; right: -100%; width: 100vw;" 
  >
    <div class="px-8 py-12 space-y-8">
      {siteConfig.navigation.map((item) => (
        <a
          href={item.href}
          class="block px-6 py-4 text-xl font-serif font-medium text-neutral-900 dark:text-neutral-100 hover:bg-primary-50 dark:hover:bg-primary-950/20 hover:text-primary-700 dark:hover:text-primary-400 transition-all duration-300 border-l-2 border-transparent hover:border-primary-600 uppercase tracking-wide"
          data-mobile-menu-link
        >
          {item.label}
        </a>
      ))}
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div 
    class="md:hidden fixed inset-0 bg-neutral-900/60 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-300 ease-in-out z-30"
    data-mobile-overlay
  ></div>
</nav>

<script>
  function initMobileMenu() {
    const button = document.querySelector('[data-mobile-menu-button]') as HTMLButtonElement;
    const menu = document.querySelector('[data-mobile-menu]') as HTMLElement;
    const overlay = document.querySelector('[data-mobile-overlay]') as HTMLElement;
    const menuLinks = document.querySelectorAll('[data-mobile-menu-link]');

    if (!button || !menu || !overlay) return;

    let isOpen = false;

    function toggleMenu() {
      isOpen = !isOpen;
      button.setAttribute('aria-expanded', isOpen.toString());
      
        if (isOpen) {
          // Show menu and enable pointer events for interaction
          menu.classList.remove('translate-x-full', 'pointer-events-none');
          overlay.classList.remove('opacity-0', 'pointer-events-none');
          document.body.classList.add('overflow-hidden');
        } else {
          // Hide menu and disable pointer events so off-screen menu can't be dragged into view
          menu.classList.add('translate-x-full', 'pointer-events-none');
          overlay.classList.add('opacity-0', 'pointer-events-none');
          document.body.classList.remove('overflow-hidden');
        }
    }

    function closeMenu() {
      if (isOpen) {
        toggleMenu();
      }
    }

    button.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', closeMenu);
    
    // Close menu when clicking on links
    menuLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeMenu();
      }
    });
  }

  // Initialize on page load and after navigation
  document.addEventListener('DOMContentLoaded', initMobileMenu);
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>